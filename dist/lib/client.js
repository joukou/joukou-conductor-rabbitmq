var Q, RabbitMQClient, amqplib, uuid;

amqplib = require('amqplib');

Q = require('q');

uuid = require('node-uuid');

RabbitMQClient = (function() {
  RabbitMQClient.prototype._channelDeferred = null;

  RabbitMQClient.prototype.connection = null;

  RabbitMQClient.prototype.channel = null;

  RabbitMQClient.prototype.key = null;

  RabbitMQClient.prototype.exchange = null;

  RabbitMQClient.prototype.consumer = null;

  RabbitMQClient.prototype.on = {
    connection: null,
    channel: null
  };

  function RabbitMQClient(exchange, key) {
    this.exchange = exchange;
    this.key = key;
    this._channelDeferred = Q.defer();
    this.on = {
      connection: amqplib.connect(exchange),
      channel: this._channelDeferred.promise
    };
    this._setupConnection();
  }

  RabbitMQClient.prototype._setupConnection = function() {
    return this.on.connection.then((function(_this) {
      return function() {
        return _this._onConnection.apply(_this, arguments);
      };
    })(this))["catch"]((function(_this) {
      return function(err) {
        _this._channelDeferred.reject(err);
      };
    })(this));
  };

  RabbitMQClient.prototype._onConnection = function(connection) {
    this.connection = connection;
    return this._setupChannel();
  };

  RabbitMQClient.prototype._setupChannel = function() {
    var ok;
    ok = this.connection.createChannel();
    return ok.then((function(_this) {
      return function() {
        _this._onChannel.apply(_this, arguments);
      };
    })(this))["catch"]((function(_this) {
      return function(err) {
        _this._channelDeferred.reject(err);
      };
    })(this));
  };

  RabbitMQClient.prototype._onChannel = function(channel) {
    this.channel = channel;
    return this._channelDeferred.resolve(this);
  };

  RabbitMQClient.prototype.cancel = function(consumerTag) {
    if (!this.channel) {
      return Q.reject(new Error("Not connected"));
    }
    return this.channel.cancel(consumerTag);
  };

  RabbitMQClient.prototype.consume = function(callback, contentOnly, consumerTag) {
    if (!(callback instanceof Function)) {
      throw new TypeError("Callback is expected to be a Function");
    }
    if (!consumerTag) {
      consumerTag = uuid.v4();
    }
    this.on.channel.then((function(_this) {
      return function() {
        _this.channel.assertQueue(_this.key);
        return _this.channel.consume(_this.key, function(message) {
          if (message === null || message === void 0) {
            return;
          }
          if (contentOnly) {
            message = message.content;
          }
          if (message === null || message === void 0) {
            return;
          }
          return callback(null, message);
        }, {
          consumerTag: consumerTag
        });
      };
    })(this)).fail(function(err) {
      callback(err, null);
    });
    return consumerTag;
  };

  RabbitMQClient.prototype.send = function(message) {
    var deferred;
    if (!Buffer.isBuffer(message)) {
      if (typeof message !== 'string') {
        message = JSON.stringify(message);
      }
      message = new Buffer(message);
    }
    deferred = Q.defer();
    this.on.channel.then((function(_this) {
      return function() {
        _this.channel.assertQueue(_this.key);
        deferred.resolve(_this.channel.sendToQueue(_this.key, message));
        return null;
      };
    })(this)).fail(deferred.reject);
    return deferred.promise;
  };

  return RabbitMQClient;

})();

module.exports = {
  getClient: function(exchange, key) {
    return new RabbitMQClient(exchange, key);
  },
  RabbitMQClient: RabbitMQClient
};

//# sourceMappingURL=data:application/json;base64,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QUFBLENBQUE7QUFBQSxRQUdBLFFBQVEsQ0FBQyxPQUFULENBQ0UsS0FBQyxDQUFBLE9BQU8sQ0FBQyxXQUFULENBQXFCLEtBQUMsQ0FBQSxHQUF0QixFQUEyQixPQUEzQixDQURGLENBSEEsQ0FBQTtlQU1BLEtBUG9CO01BQUEsRUFBQTtJQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBdEIsQ0FTQSxDQUFDLElBVEQsQ0FVRSxRQUFRLENBQUMsTUFWWCxDQUxBLENBQUE7QUFpQkEsV0FBTyxRQUFRLENBQUMsT0FBaEIsQ0FsQkk7RUFBQSxDQXZFTixDQUFBOzt3QkFBQTs7SUFMRixDQUFBOztBQUFBLE1BK0ZNLENBQUMsT0FBUCxHQUNFO0FBQUEsRUFBQSxTQUFBLEVBQVcsU0FBQyxRQUFELEVBQVcsR0FBWCxHQUFBO0FBQ1QsV0FBVyxJQUFBLGNBQUEsQ0FBZSxRQUFmLEVBQXlCLEdBQXpCLENBQVgsQ0FEUztFQUFBLENBQVg7QUFBQSxFQUVBLGNBQUEsRUFBZ0IsY0FGaEI7Q0FoR0YsQ0FBQSIsImZpbGUiOiJsaWIvY2xpZW50LmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiYW1xcGxpYiA9IHJlcXVpcmUoJ2FtcXBsaWInKVxuUSAgICAgICA9IHJlcXVpcmUoJ3EnKVxudXVpZCAgICA9IHJlcXVpcmUoJ25vZGUtdXVpZCcpXG5cbmNsYXNzIFJhYmJpdE1RQ2xpZW50XG4gIF9jaGFubmVsRGVmZXJyZWQ6IG51bGxcbiAgY29ubmVjdGlvbjogbnVsbFxuICBjaGFubmVsOiBudWxsXG4gIGtleTogbnVsbFxuICBleGNoYW5nZTogbnVsbFxuICBjb25zdW1lcjogbnVsbFxuICBvbjpcbiAgICBjb25uZWN0aW9uOiBudWxsXG4gICAgY2hhbm5lbDogbnVsbFxuICBjb25zdHJ1Y3RvcjogKGV4Y2hhbmdlLCBrZXkpIC0+XG4gICAgdGhpcy5leGNoYW5nZSA9IGV4Y2hhbmdlXG4gICAgdGhpcy5rZXkgPSBrZXlcbiAgICB0aGlzLl9jaGFubmVsRGVmZXJyZWQgPSBRLmRlZmVyKClcbiAgICB0aGlzLm9uID1cbiAgICAgIGNvbm5lY3Rpb246IGFtcXBsaWIuY29ubmVjdChleGNoYW5nZSlcbiAgICAgIGNoYW5uZWw6IHRoaXMuX2NoYW5uZWxEZWZlcnJlZC5wcm9taXNlXG4gICAgdGhpcy5fc2V0dXBDb25uZWN0aW9uKClcbiAgX3NldHVwQ29ubmVjdGlvbjogLT5cbiAgICB0aGlzLm9uLmNvbm5lY3Rpb24udGhlbiggPT5cbiAgICAgIEBfb25Db25uZWN0aW9uLmFwcGx5KEAsIGFyZ3VtZW50cylcbiAgICApLmNhdGNoKCAoZXJyKSA9PlxuICAgICAgQF9jaGFubmVsRGVmZXJyZWQucmVqZWN0KGVycilcbiAgICAgIHJldHVyblxuICAgIClcbiAgX29uQ29ubmVjdGlvbjogKGNvbm5lY3Rpb24pIC0+XG4gICAgdGhpcy5jb25uZWN0aW9uID0gY29ubmVjdGlvblxuICAgIHRoaXMuX3NldHVwQ2hhbm5lbCgpXG4gIF9zZXR1cENoYW5uZWw6IC0+XG4gICAgb2sgPSB0aGlzLmNvbm5lY3Rpb24uY3JlYXRlQ2hhbm5lbCgpXG4gICAgb2sudGhlbiggPT5cbiAgICAgIEBfb25DaGFubmVsLmFwcGx5KEAsIGFyZ3VtZW50cylcbiAgICAgIHJldHVyblxuICAgICkuY2F0Y2goIChlcnIpID0+XG4gICAgICBAX2NoYW5uZWxEZWZlcnJlZC5yZWplY3QoZXJyKVxuICAgICAgcmV0dXJuXG4gICAgKVxuICBfb25DaGFubmVsOiAoY2hhbm5lbCkgLT5cbiAgICB0aGlzLmNoYW5uZWwgPSBjaGFubmVsXG4gICAgdGhpcy5fY2hhbm5lbERlZmVycmVkLnJlc29sdmUoQClcbiAgY2FuY2VsOiAoY29uc3VtZXJUYWcpIC0+XG4gICAgIyBOb3QgY29ubmVjdGVkXG4gICAgaWYgbm90IHRoaXMuY2hhbm5lbFxuICAgICAgcmV0dXJuIFEucmVqZWN0KG5ldyBFcnJvcihcIk5vdCBjb25uZWN0ZWRcIikpXG4gICAgdGhpcy5jaGFubmVsLmNhbmNlbChjb25zdW1lclRhZylcbiAgY29uc3VtZTogKGNhbGxiYWNrLCBjb250ZW50T25seSwgY29uc3VtZXJUYWcpIC0+XG4gICAgI1VuIHByb21pc2UtYWJsZSwgY2FsbGJhY2sgaXMgY2FsbGVkIG11bHRpcGxlIHRpbWVzXG4gICAgaWYgY2FsbGJhY2sgbm90IGluc3RhbmNlb2YgRnVuY3Rpb25cbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYWxsYmFjayBpcyBleHBlY3RlZCB0byBiZSBhIEZ1bmN0aW9uXCIpXG4gICAgaWYgbm90IGNvbnN1bWVyVGFnXG4gICAgICAjIENyZWF0ZSBvbmUgc28gdGhleSBjYW4gY2FuY2VsIGl0XG4gICAgICBjb25zdW1lclRhZyA9IHV1aWQudjQoKVxuICAgIHRoaXMub24uY2hhbm5lbC50aGVuKD0+XG4gICAgICBAY2hhbm5lbC5hc3NlcnRRdWV1ZShAa2V5KVxuICAgICAgQGNoYW5uZWwuY29uc3VtZShAa2V5LCAobWVzc2FnZSkgLT5cbiAgICAgICAgIyBGaWx0ZXIgdGhlIGR1ZHMgaGVyZVxuICAgICAgICBpZiBtZXNzYWdlIGlzIG51bGwgb3IgbWVzc2FnZSBpcyB1bmRlZmluZWRcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgaWYgY29udGVudE9ubHlcbiAgICAgICAgICBtZXNzYWdlID0gbWVzc2FnZS5jb250ZW50XG4gICAgICAgICMgQ2hlY2sgYWdhaW5cbiAgICAgICAgaWYgbWVzc2FnZSBpcyBudWxsIG9yIG1lc3NhZ2UgaXMgdW5kZWZpbmVkXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIG1lc3NhZ2UpXG4gICAgICAsIGNvbnN1bWVyVGFnOiBjb25zdW1lclRhZ1xuICAgICAgKVxuICAgIClcbiAgICAuZmFpbCggKGVycikgLT5cbiAgICAgIGNhbGxiYWNrKGVyciwgbnVsbClcbiAgICAgIHJldHVyblxuICAgIClcbiAgICBjb25zdW1lclRhZ1xuICBzZW5kOiAobWVzc2FnZSkgLT5cbiAgICBpZiBub3QgQnVmZmVyLmlzQnVmZmVyKCBtZXNzYWdlIClcbiAgICAgIGlmIHR5cGVvZiBtZXNzYWdlIGlzbnQgJ3N0cmluZydcbiAgICAgICAgbWVzc2FnZSA9IEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpXG4gICAgICBtZXNzYWdlID0gbmV3IEJ1ZmZlcihtZXNzYWdlKVxuICAgIGRlZmVycmVkID0gUS5kZWZlcigpXG4gICAgdGhpcy5vbi5jaGFubmVsLnRoZW4oID0+XG4gICAgICBAY2hhbm5lbC5hc3NlcnRRdWV1ZShAa2V5KVxuICAgICAgIyBzZW5kVG9RdWV1ZSBzaG91bGQgcmV0dXJuIGEgcmVzcG9uc2UgZnJvbSBCdWZmZXIud3JpdGVcbiAgICAgICMgaHR0cDovL25vZGVqcy5vcmcvYXBpL2J1ZmZlci5odG1sI2J1ZmZlcl9idWZfd3JpdGVfc3RyaW5nX29mZnNldF9sZW5ndGhfZW5jb2RpbmdcbiAgICAgIGRlZmVycmVkLnJlc29sdmUoXG4gICAgICAgIEBjaGFubmVsLnNlbmRUb1F1ZXVlKEBrZXksIG1lc3NhZ2UpXG4gICAgICApXG4gICAgICBudWxsXG4gICAgKVxuICAgIC5mYWlsKFxuICAgICAgZGVmZXJyZWQucmVqZWN0XG4gICAgKVxuICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlXG5tb2R1bGUuZXhwb3J0cyA9XG4gIGdldENsaWVudDogKGV4Y2hhbmdlLCBrZXkpIC0+XG4gICAgcmV0dXJuIG5ldyBSYWJiaXRNUUNsaWVudChleGNoYW5nZSwga2V5KVxuICBSYWJiaXRNUUNsaWVudDogUmFiYml0TVFDbGllbnQiXX0=